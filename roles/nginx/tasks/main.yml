---
- name: Install nginx web server
  apt: name=nginx state=latest force=yes
  tags: 
    - master

- name: Remove default nginx vhost config file (if configured).
  file:
    path: /etc/nginx/sites-enabled/default
    state: absent
  notify: restart nginx
  tags: 
    - master

- name: Upload nginx.conf
  copy: src=nginx.conf dest=/etc/nginx/nginx.conf backup=yes
  notify: restart nginx
  tags: 
    - master

- name: Copy redirect 301 rules to redirect old kiwix links
  template: src=redirect.j2 dest=/etc/nginx/sites-available/redirect
  tags: 
    - custom

- name: Enable Virtual host
  file: src=/etc/nginx/sites-available/redirect dest=/etc/nginx/sites-enabled/redirect state=link
  notify: restart nginx
  tags: 
    - custom